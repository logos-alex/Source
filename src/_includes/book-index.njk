{% extends "base.njk" %}

{% block content %}
  <div class="text-main">
    {# 爪 转 转专转 转 转  注爪 #}
    <h1>{{ title }}</h1>
    {% if source or figure %}
      {% set sourceHebrew = sources[source] or source %}
      {% set figureHebrew = figures[figure] or figure %}
      <p><em>拽专: {{ sourceHebrew or ' 爪' }} | 住: {{ figureHebrew or ' 爪' }}</em></p>
    {% endif %}
    {{ content | safe }}
  </div>

  {# --- 转 注  注专 住驻专  转  --- #}
  <div class="table-of-contents" style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
      <h3 style="margin: 0;">驻专拽 拽住</h3>
      
      <div class="toc-dropdown" style="position: relative; display: inline-block;">
        <button class="dropbtn" style="background: var(--bg-color); border: 1px solid var(--border-color); padding: 5px 15px; cursor: pointer; color: var(--text-color); font-family: inherit;"> 专 驻专拽...</button>
        <div class="toc-dropdown-content" style="right: auto; left: 0;">
          <div class="toc-dropdown-header">驻专拽 拽住</div>
          <ol>
            {% for item in collections.textsByBook[book] %}
              {% if item.data.pageNumber != 0 %}
                <li><a href="{{ item.url | url }}">{{ item.data.title }}</a></li>
              {% endif %}
            {% endfor %}
          </ol>
        </div>
      </div>
    </div>
    
    {# --- 驻专 住 砖 --- #}
    {% set lastVersion = 'none' %}
    <ul class="toc-list">
    {% for pageItem in collections.textsByBook[book] %}
      {% if pageItem.data.pageNumber > 0 %}
        {% if pageItem.url.includes('/a/') %}
          {% if lastVersion !== 'a' %}
            {% if lastVersion !== 'none' %}</ul><div style="height: 20px; border-top: 1px solid var(--border-color); margin: 15px 0;"></div><h4 style="margin: 10px 0 10px 0; color: var(--header-color);">住 '</h4><ul class="toc-list">{% endif %}
            {% set lastVersion = 'a' %}
          {% endif %}
        {% elif pageItem.url.includes('/b/') %}
          {% if lastVersion !== 'b' %}
            </ul><div style="height: 20px; border-top: 1px solid var(--border-color); margin: 15px 0;"></div><h4 style="margin: 10px 0 10px 0; color: var(--header-color);">住 '</h4><ul class="toc-list">
            {% set lastVersion = 'b' %}
          {% endif %}
        {% endif %}
        
        <li>
          <a href="{{ pageItem.url | url }}">
            {{ pageItem.data.title }}
          </a>
        </li>
      {% endif %}
    {% endfor %}
    </ul>
  </div>

  {# --- 专 转转 砖 Disqus --- #}
  <div id="comments-section" style="margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border-color);">
    <h3>转转</h3>
    <div id="disqus_thread"></div>
    <script>
        (function() {
            try {
                var disqus_config = function () {
                    this.page.url = "https://heb-sources.netlify.app{{ page.url | url }}";
                    this.page.identifier = "{{ page.url | url }}";
                };
                var d = document, s = d.createElement('script');
                s.src = 'https://hebrew-aramaic-sources.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                s.onerror = function() { console.log('Disqus loading handled'); };
                (d.head || d.body).appendChild(s);
            } catch(e) {
                console.log('Disqus error handled');
            }
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
{% endblock %}
