{% extends "base.njk" %}

{% block content %}
  <!-- Reading Progress Bar -->
  <div class="reading-progress">
    <div class="reading-progress-bar" id="readingProgress"></div>
  </div>
  
  <div class="text-main">
    <h1>{{ title }}</h1>
    
    {% if source or figure %}
      {% set sourceHebrew = sources[source] or source %}
      {% set figureHebrew = figures[figure] or figure %}
      <p><em>××§×•×¨: {{ sourceHebrew or '×œ× ××¦×•×™×Ÿ' }} | ×™×—×•×¡: {{ figureHebrew or '×œ× ××¦×•×™×Ÿ' }}</em></p>
    {% endif %}
    
    {{ content | safe }}
  </div>
  
  <script>
    window.addEventListener('scroll', function() {
      const windowHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (window.scrollY / windowHeight) * 100;
      document.getElementById('readingProgress').style.width = scrolled + '%';
    });
  </script>

  <div class="footnotes">
    <h3>×”×¢×¨×•×ª ×•×‘×™××•×¨×™×</h3>
    <ol>
      {% for note in notes %}
        {# ×”×•×¡×¤× ×• id ×œ×›×œ ×”×¢×¨×” ×›×“×™ ×œ××¤×©×¨ ×§×™×©×•×¨ ×™×©×™×¨ ×‘×¢×ª×™×“ #}
        <li id="note-{{ loop.index }}">{{ note | safe }}</li>
      {% endfor %}
    </ol>
  </div>

  {# --- × ×™×•×•×˜ ×‘×™×Ÿ ×¢××•×“×™× (×¢× ×›×¤×ª×•×¨ ×—×–×¨×” ×œ×ª×•×›×Ÿ ×”×¢× ×™×™× ×™×) --- #}
  {% set pagesInBook = collections.textsByBook[book] %}
  {% set currentPageIndex = pagesInBook | findIndexByUrl(page.url) %}
  
  <nav class="pagination">
    {# ×›×¤×ª×•×¨ "×”×§×•×“×" (××•×¤×™×¢ ××™××™×Ÿ) - ×¦×¨×™×š ×—×¥ ×™××™× ×” #}
    {% if currentPageIndex > 0 %}
      {% set prevPage = pagesInBook[currentPageIndex - 1] %}
      <a href="{{ prevPage.url | url }}" class="prev">â†’ {{ prevPage.data.title }}</a>
    {% endif %}

    {# === ×”×›×¤×ª×•×¨ ×”×—×“×© ×©×”×•×¡×¤× ×• === #}
    {# ×”×§×™×©×•×¨ ××•×‘×™×œ ×œ×¢××•×“ ×”××‘×•× ×©×œ ×”×¡×¤×¨ (×ª××™×“ ×‘××™× ×“×§×¡ 0) #}
    <a href="{{ pagesInBook[0].url | url }}" class="home-link">ğŸ“– ×ª×•×›×Ÿ ×”×¢× ×™×™× ×™×</a>
    {# ============================== #}
    
    {# ×›×¤×ª×•×¨ "×”×‘×" (××•×¤×™×¢ ××©×××œ) - ×¦×¨×™×š ×—×¥ ×©×××œ×” #}
    {% if currentPageIndex < pagesInBook.length - 1 %}
      {% set nextPage = pagesInBook[currentPageIndex + 1] %}
      <a href="{{ nextPage.url | url }}" class="next">â† {{ nextPage.data.title }}</a>
    {% endif %}
  </nav>

  {# --- ××–×•×¨ ×”×ª×’×•×‘×•×ª ×©×œ Disqus --- #}
  <div id="comments-section" style="margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border-color);">
    <h3>×ª×’×•×‘×•×ª</h3>
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function () {
            this.page.url = "https://heb-sources.netlify.app{{ page.url | url }}";
            this.page.identifier = "{{ page.url | url }}";
        };
        (function() {
            var d = document, s = d.createElement('script');
            s.src = 'https://hebrew-aramaic-sources.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>

{% endblock %}
